<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test</title>
</head>
<body>
  
  <label for="txtAI">AI Bot ID</label> <input type="text" id="txtAI" placeholder="AI Bot ID" />
  <br />
  <br />
  <label for="txtName">Name</label> <input type="text" id="txtName" placeholder="Your bot name">
  <br />
  <br />
  <label for="txtCode">Code</label><br />
  <textarea id="txtCode"></textarea>
  <br />
  <br />
  <label for="txtLanguage">Language</label> <input type="text" id="txtLanguage" value="PYTHON" placeholder="PYTHON, JAVA, RUBY" />
  <br />
  <br />
  <button onclick="play()">Play</button>

  <script>

    function init() {
      gapi.client.load("rockpaperscissorslizardspock", "v1", null, "https://smu-is429-group-project.appspot.com/_ah/api");
    }

    function play() {

      var aiBotId = document.getElementById("txtAI").value;
      var name = document.getElementById("txtName").value;
      var code = document.getElementById("txtCode").value.replace(/\n/gm, "\\n").replace(/\"/gm, "\\\"");    // Need to escape line break and quote
      var language = document.getElementById("txtLanguage").value;

      var requestData = {};
      requestData.playerBotName = name;
      requestData.playerBotCode = code;
      requestData.aiBotId = aiBotId;
      requestData.language = language;

      gapi.client.rockpaperscissorslizardspock.newGame(requestData).execute(function(resp) {

        if(!resp.code) {

          var gameID = resp.gameSession.id;
          console.log("Received first round");
          next(gameID);

        }

      });
    }

    function next(gameID) {

      var requestData = {};
      requestData.gameID = gameID;

      gapi.client.rockpaperscissorslizardspock.getNextMove(requestData).execute(function(resp) {

        if(!resp.code) {

          console.log(resp);

          // Use recursion instead of a loop to keep on calling next() until
          // the requirements have been reached then we stop the recursion
          if(resp.gameSession.roundNo != 10) {
            next(gameID);
          }

        }

      });

    }

  </script>
  <script src="https://apis.google.com/js/client.js?onload=init"></script>

</body>
</html>