<div class="main">
	<div class="container">
		<div class="row">
			<div class="span12">
				<meta name="google-signin-clientid" content="CLIENT_ID" />
				<meta name="google-signin-scope" content="https://www.googleapis.com/auth/plus.login" />
				<meta name="google-signin-requestvisibleactions" content="http://schemas.google.com/AddActivity" />
				<meta name="google-signin-cookiepolicy" content="single_host_origin" />		
			</div> <!-- /span12 -->	
		</div> <!-- /row -->
		
		<div class="widget big-stats-container stacked">
			<div class="widget-content">
				Instruction!<br/>
				Rock-paper-scissors-lizard-Spock is an expansion of the classic selection method game rock-paper-scissors. You must be wondering how to play?
				<ol>
					<li>Sign in with your Facebook/Twitter/Google account! If you don't, your bot won't be tagged to you!</li>
					<li>Select a bot to play against with.</li>
					<li>Either select your existing bot or code your own bot.</li>
					<li>If you code your own bot, give your bot the coolest name!</li>
					<li>Select the language that you want to code in. Either Javascript, Python or Ruby.</li>
					<li>A sample code will be generated. Make modification to the code to make your bot the strongest!</li>
					<li>Do not change the method name and arguments, and please return your move in this format either 'ROCK' or 'PAPER' or 'SCISSORS' or 'LIZARD' or 'SPOCK'!</li>
					<li>Press Play and see your bot in action! :)</li>
					<li>Remember to share this on Facebook/Twitter/Google!</li>
				</ol>
			</div>
		</div>
		
		<div class="row">
			<div class="span6">
				<div class="widget stacker">
					<div class="widget-header">
						<i class="icon-star"></i>
						<h3>The Ring</h3>
					</div> <!-- /widget-header -->
				
					<div class="widget-content">
					
						<form action="" id="validation-form" class="">
							<fieldset>
								<div class="control-group">
									<label class="control-label" for="validateSelect">Select Bot to play against!</label>
									<div class="controls">
										<select id="validateSelect" name="validateSelect">
											<option value="">Select...</option>
										</select>
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="">Now code your own Bot!</label>
									<label class="control-label" for="">Bot Name</label>
									<div class="controls">
										<textarea class="span4" name="botname" id="botname" rows="1"></textarea>
									</div>
									<label class="control-label" for="">Language</label>
									<div class="controls">
										<select id="language" name="language">
											<option value="select">Select...</option>
											<option value="JAVASCRIPT">Javascript</option>
											<option value="PYTHON">Python</option>
											<option value="RUBY">Ruby</option>
											
										</select>
									</div>
									<label class="control-label" for="message">Your Code</label>
									<div class="controls">
										<textarea class="span4" name="code" id="code" rows="4"></textarea>
									</div>
								</div>
				          
								<div class="form-action">
									<!--<button type="submit" class="btn btn-danger btn" id="savebot">Save bot</button>&nbsp;&nbsp;-->
									
								</div>
							</fieldset>
						</form>
						<input id="saveBot" type="submit" value="Play" class="btn btn-danger btn">
					</div> <!-- /widget-content -->
				</div> <!-- /widget -->
			</div> <!-- /span6 -->
		
			<div class="span6">
				<div class="widget stacker">		
					<div class="widget-header">
						<i class="icon-list-alt"></i>
						<h3>Action</h3>
					</div> <!-- /widget-header -->
					<div class="widget-content">
						<div align="center" id="whoWin">
							<h4><label id="header">Select a bot to see its statistics</label></h4>
							<h4><label id="botStats" style="display:none">Bot Statistic</label></h4>
							<canvas id="canvas" height="300" width="400" style="display: none"></canvas>
							<br/>
							<h4><label id="rating"></label></h4>
						</div>
						<!--<img src = '../img/hands/spock.png' height='40' width='40'>-->
					</div> <!-- /widget-content -->
				</div> <!-- /widget -->
			</div> <!-- /span6 -->
      	</div> <!-- /row -->
    </div> <!-- /container -->
</div> <!-- /main -->



<script type="text/javascript">
var bots = [];

function init() {
	var callback = function () {
		getBotList();
	};

	//var apisToLoad = 1;
	gapi.client.load('rockpaperscissorslizardspock', 'v2', callback, 'https://smu-is429-group-project.appspot.com/_ah/api');

    document.getElementById('saveBot').onclick = function() {
            play();
    }

}

$('#validateSelect').change(function() {
	if($(this).val() === "select"){
		document.getElementById("header").style.display="block";
		document.getElementById("canvas").style.display="none";
		document.getElementById('rating').style.display="none";
		document.getElementById('botStats').style.display="none";
	} else {
		for (var i=0; i < bots.length; i++){
			if((bots[i][0] === parseInt(($(this).val())))){
				document.getElementById("botStats").style.display="block";
				document.getElementById("header").style.display="none";
				document.getElementById("rating").style.display="block";
				document.getElementById('rating').innerHTML = "Bot Rating: " + bots[i][4];

				var d = [bots[i][1],bots[i][2],bots[i][3]];
				
				if(bots[i][1] === 0 && bots[i][2] === 0 && bots[i][3] === 0) {
					document.getElementById("botStats").innerHTML = "Bot has not been challenged!";
					break;
				} else {
					var barChartData = {
						labels : ["Win","Draw","Lose"],
						datasets : [
							{
								fillColor : "rgba(220,220,220,0.5)",
								strokeColor : "rgba(220,220,220,1)",
								data : d
							}
						]
					}

					var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Bar(barChartData);
					document.getElementById("canvas").style.display="block";
					break;
				}
			}
		}
	}
});

$('#language').change(function() {
	var jsCode = "function play_game(history) { \n  return 'YOUR MOVE'; \n}";
	var pythonCode = "def play_game(history):\n  return 'YOUR MOVE'";
	var rubyCode = "def play_game(history)\n  return 'YOUR MOVE'\nend";
	if($(this).val() === "JAVASCRIPT") {
		document.getElementById('code').value = jsCode;
	} else if ($(this).val() === "PYTHON") {
		document.getElementById('code').value = pythonCode;
	} else {
		document.getElementById('code').value = rubyCode;
	}
});

function play() {
	var botDDL = document.getElementById('validateSelect');
	var langDDL = document.getElementById('language');
	if(botDDL.options[botDDL.selectedIndex].value === "select") {
		alert('Please select a bot to play against with!');
	} else if (langDDL.options[langDDL.selectedIndex].value === "select") {
		alert('Please select a language!');
	} else if (document.getElementById('botname').value.length <= 0) {
		alert('Please give your bot a name!');
	} else if (document.getElementById('code').value.length <= 0) {
		alert('Please enter your codes!');
	} else {
		if(document.getElementById("canvas") != null) {
			document.getElementById("canvas").style.display="none";
		}
		if(document.getElementById("rating") != null) {
			document.getElementById('rating').style.display="none";
		}
		if(document.getElementById("botStats") != null) {
			document.getElementById('botStats').style.display="none";
		}
		if(document.getElementById("header") != null) {
			document.getElementById("header").style.display="none";
		}

		var _BotName = document.getElementById('botname').value;
		var _Code = document.getElementById('code').value.replace(/\n/gm, "\\n").replace(/\"/gm, "\\\"");
		var _AiBotId = document.getElementById('validateSelect').value;
		var _BotLanguage = document.getElementById('language').value;
		var _tempUserId = document.getElementById('userid');
		var result = "";

		var requestData = {};
		requestData.playerBotName = _BotName;
		requestData.playerBotCode = _Code;
		requestData.aiBotId = _AiBotId;
		requestData.language = _BotLanguage;
		if(_tempUserId.value.length > 0) {
			requestData.userId = _tempUserId.value;
		} else {
			requestData.userId = "null";
		}
		var rock = "<img src = '../img/hands/rock.png' height='70' width='70'>";
		var paper = "<img src = '../img/hands/paper.png' height='70' width='70'>";
		var scissors = "<img src = '../img/hands/scissors.png' height='70' width='70'>";
		var lizard = "<img src = '../img/hands/lizard.png' height='70' width='70'>";
		var spock = "<img src = '../img/hands/spock.png' height='70' width='70'>";
		var aiMovePic = "";
		var playerMovePic = "";
		var winner = "You lose.";
		var win = 0;
		var lose = 0;
		var draw = 0;
		
		gapi.client.rockpaperscissorslizardspock.newGame(requestData).execute(function(resp) {

			if(!resp.code) {
				if(resp.success === false) {
					alert('Your codes have error. Please try again!');
				} else {
					var gameID = resp.gameSession.id;
					console.log("Received first round");
					if(parseInt(resp.gameSession.score) === 0){
						winner = "Draw Game.";
						draw++;
					}else if(parseInt(resp.gameSession.score) === 1){
						winner = "You win!";
						win++;
					}else{
						lose++;
					}
					
					if(resp.gameSession.playerMove == 'LIZARD'){
						playerMovePic = lizard;
					}else if(resp.gameSession.playerMove == 'ROCK'){
						playerMovePic = rock;
					}else if(resp.gameSession.playerMove == 'SCISSORS'){
						playerMovePic = scissors;
					}else if(resp.gameSession.playerMove == 'PAPER'){
						playerMovePic = paper;
					}else if(resp.gameSession.playerMove == 'SPOCK'){
						playerMovePic = spock;
					}
					
					if(resp.gameSession.aiMove == 'LIZARD'){
						aiMovePic = lizard;
					}else if(resp.gameSession.aiMove == 'ROCK'){
						aiMovePic = rock;
					}else if(resp.gameSession.aiMove == 'SCISSORS'){
						aiMovePic = scissors;
					}else if(resp.gameSession.aiMove == 'PAPER'){
						aiMovePic = paper;
					}else if(resp.gameSession.aiMove == 'SPOCK'){
						aiMovePic = spock;
					}
					
					result = result + "Round no: "+resp.gameSession.roundNo+ " <br> " +playerMovePic+ " vs "+aiMovePic +" <br> "+winner + "<br>";
					console.log(result);
					document.getElementById('whoWin').innerHTML = result
					console.log("start recursion");
					next(gameID, result, win, lose, draw);
					console.log("end recursion");
				}
			}

		});
	}
}

function next(gameID, r, w,l,d) {

	var requestData = {};
	requestData.gameID = gameID;
	var winner = "You lose.";
	var result = r;
	var win = w;
	var lose = l;
	var draw = d;
	var rock = "<img src = '../img/hands/rock.png' height='70' width='70'/>";
	var paper = "<img src = '../img/hands/paper.png' height='70' width='70'/>";
	var scissors = "<img src = '../img/hands/scissors.png' height='70' width='70'/>";
	var lizard = "<img src = '../img/hands/lizard.png' height='70' width='70'/>";
	var spock = "<img src = '../img/hands/spock.png' height='70' width='70'/>";
	var aiMovePic = "";
	var playerMovePic = "";

	gapi.client.rockpaperscissorslizardspock.getNextMove(requestData).execute(function(resp) {

		if(!resp.code) {
			if(parseInt(resp.gameSession.score) === 0){
				winner = "Draw Game.";
				draw++;
			}else if(parseInt(resp.gameSession.score) === 1){
				winner = "You win!";
				win++;
			}else{
				lose++;
			}
			
			if(resp.gameSession.playerMove == 'LIZARD'){
				playerMovePic = lizard;
			}else if(resp.gameSession.playerMove == 'ROCK'){
				playerMovePic = rock;
			}else if(resp.gameSession.playerMove == 'SCISSORS'){
				playerMovePic = scissors;
			}else if(resp.gameSession.playerMove == 'PAPER'){
				playerMovePic = paper;
			}else if(resp.gameSession.playerMove == 'SPOCK'){
				playerMovePic = spock;
			}
			
			if(resp.gameSession.aiMove == 'LIZARD'){
				aiMovePic = lizard;
			}else if(resp.gameSession.aiMove == 'ROCK'){
				aiMovePic = rock;
			}else if(resp.gameSession.aiMove == 'SCISSORS'){
				aiMovePic = scissors;
			}else if(resp.gameSession.aiMove == 'PAPER'){
				aiMovePic = paper;
			}else if(resp.gameSession.aiMove == 'SPOCK'){
				aiMovePic = spock;
			}
			result = result + "Round no: "+resp.gameSession.roundNo+ " <br> " +playerMovePic+ " vs "+aiMovePic +" <br> "+winner + "<br>";
			
			document.getElementById('whoWin').innerHTML = result;
			console.log(resp);
			
			// Use recursion instead of a loop to keep on calling next() until
			// the requirements have been reached then we stop the recursion
			if(resp.gameSession.roundNo != 10) {
				next(gameID, result,win,lose,draw);
				
			}
			console.log("Win: "+win+" Draw: "+draw+" lose: "+lose);
			//console.log(resp.gameSession.playerBotId);
			
			gapi.client.rockpaperscissorslizardspock.getBotList().execute(function(resp1) {
				if(!resp1.code) {
					resp1.items = resp1.items || [];
					console.log(resp1.items);
					for (var i=0; i<resp1.items.length;i++){
						if(resp1.items[i].id === resp.gameSession.playerBotId) {
							result = result + "Your bot rating: " + resp1.items[i].elo + "<br/>";
							break;
						}
					}
					document.getElementById('whoWin').innerHTML = result;
				}
			});
			
			gapi.client.rockpaperscissorslizardspock.getBotList().execute(function(resp2) {
				if(!resp2.code) {
					resp2.items = resp2.items || [];
					console.log(resp2.items);
					for (var i=0; i<resp2.items.length;i++){
						if(resp2.items[i].id === resp.gameSession.aiBotId) {
							result = result + resp2.items[i].name + " rating: " + resp2.items[i].elo + "<br/>";
							break;
						}
					}
					document.getElementById('whoWin').innerHTML = result;
				}
			});
		}

	});

}

function getResult(gameID){
	
}

function getBotList() {
	console.log("inside list quotes");
	gapi.client.rockpaperscissorslizardspock.getBotList().execute(function(resp) {
		console.log(resp);
		if (!resp.code) {
			resp.items = resp.items || [];
			console.log(resp.items);
			var result = "<option value='select'>Select...</option>";
			for (var i=0;i<resp.items.length;i++) {
				console.log("loop");
				result = result+"<option value='"+resp.items[i].id+"'>"+resp.items[i].name + "</option>";
				temp = [];
				temp.push(resp.items[i].id);
				temp.push(resp.items[i].winCount);
				temp.push(resp.items[i].drawCount);
				temp.push(resp.items[i].lossCount);
				temp.push(resp.items[i].elo);
				bots.push(temp);
			}
			document.getElementById('validateSelect').innerHTML = result;
		}
	});
}

(function() {
	var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
	po.src = 'https://apis.google.com/js/plusone.js?onload=onLoadCallback';
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();


</script>
<script src="https://apis.google.com/js/client.js?onload=init"></script>